CMAKE_BUILDDIR="${CMAKE_BUILDDIR:-.}"

function Prepare() {
  rsync -av --delete --delete-excluded $SOURCEDIR/ ./
}

function Configure() {
  cmake ${CMAKE_BUILDDIR} -DCMAKE_INSTALL_PREFIX="$INSTALLROOT" --log-level DEBUG 
}

function Make() {
  cmake --build ${CMAKE_BUILDDIR} -- ${CMAKE_OPTIONS} ${JOBS:+-j$JOBS}
}

function MakeInstall() {
  cmake ${CMAKE_BUILDDIR} install
}

function PostInstall() {
  true
}

function Clean() {
  rm -f $INSTALLROOT/lib/*.la
  rm -rf $INSTALLROOT/share
}

. ${BITS_RECIPE_TOOLS_ROOT}/ModuleRecipe

function Run() {
    mkdir -p build
    pushd build
    case $1 in
	Prepare)
  	  Prepare
	  ;;
	Build)
          Configure && Make && MakeInstall && MakeModule && PostInstall && Clean
          ;;
	*)
          Prepare && Configure && Make && MakeInstall && MakeModule && PostInstall && Clean
          ;;
    esac
    popd
}


